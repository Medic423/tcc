// EMS Database Schema
generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/ems"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_EMS")
}

model EMSUser {
  id           String   @id @default(cuid())
  email        String   @unique
  password     String
  name         String
  agencyName   String
  agencyId     String?  // Reference to EMSAgency
  isActive     Boolean  @default(true)
  userType     String   @default("EMS") // EMS, ADMIN
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  agency           EMSAgency? @relation(fields: [agencyId], references: [id])
  transportRequests TransportRequest[]

  @@map("ems_users")
}

model EMSAgency {
  id               String   @id @default(cuid())
  name             String
  contactName      String
  phone            String
  email            String
  address          String
  city             String
  state            String
  zipCode          String
  serviceArea      String[]
  operatingHours   Json?
  capabilities     String[]
  pricingStructure Json?
  isActive         Boolean  @default(true)
  status           String   @default("ACTIVE")
  addedBy          String?
  addedAt          DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  users            EMSUser[]
  units            Unit[]

  @@map("ems_agencies")
}

model Unit {
  id             String   @id @default(cuid())
  agencyId       String?
  unitNumber     String
  type           String
  capabilities   String[]
  currentStatus  String   @default("AVAILABLE")
  currentLocation Json?
  isActive       Boolean  @default(true)
  
  // Trip assignment tracking
  assignedTripId String?
  lastStatusUpdate DateTime @default(now())
  statusHistory  Json?     // Array of status changes with timestamps
  currentTripDetails Json? // Current trip information if assigned
  
  // Location tracking
  lastKnownLocation Json?  // Last GPS coordinates
  locationUpdatedAt DateTime?
  
  // Performance metrics
  totalTripsCompleted Int @default(0)
  averageResponseTime Float? // Average response time in minutes
  lastMaintenanceDate DateTime?
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  agency         EMSAgency? @relation(fields: [agencyId], references: [id])

  @@map("units")
}

model TransportRequest {
  id                    String    @id @default(cuid())
  tripNumber            String?   @unique
  patientId             String
  patientWeight         String?
  specialNeeds          String?
  originFacilityId      String?
  destinationFacilityId String?
  fromLocation          String?
  toLocation            String?
  scheduledTime         DateTime?
  transportLevel        String
  urgencyLevel          String?
  priority              String
  status                String    @default("PENDING")
  specialRequirements   String?
  
  // Clinical Details
  diagnosis             String?
  mobilityLevel         String?
  oxygenRequired        Boolean   @default(false)
  monitoringRequired    Boolean   @default(false)
  
  // QR Code
  generateQRCode        Boolean   @default(false)
  qrCodeData            String?
  
  // Agency Notifications
  selectedAgencies      String[]
  notificationRadius    Int?
  
  // Time Tracking
  transferRequestTime   DateTime?
  transferAcceptedTime  DateTime?
  emsArrivalTime        DateTime?
  emsDepartureTime      DateTime?
  
  requestTimestamp      DateTime  @default(now())
  acceptedTimestamp     DateTime?
  pickupTimestamp       DateTime?
  completionTimestamp   DateTime?
  assignedAgencyId      String?
  assignedUnitId        String?
  createdById           String?
  readyStart            DateTime?
  readyEnd              DateTime?
  isolation             Boolean   @default(false)
  bariatric             Boolean   @default(false)
  notes                 String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  // Relations
  createdBy             EMSUser? @relation(fields: [createdById], references: [id])

  @@map("transport_requests")
}